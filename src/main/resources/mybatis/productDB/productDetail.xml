<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycompany.backOfficeAPI.dao.productDB.ProductDetailDAO">
	<select id="selectByProductDetailId" parameterType="string" resultType="productDetail">
		SELECT *
		FROM product_detail
		WHERE product_detail_id = #{productDetailId} 
	</select>
		
	<select id="selectAllByProductId" parameterType="string" resultType="productDetail">
		SELECT *
		FROM product_detail
		WHERE product_id = #{productId} 
	</select>
	
	<select id="selectPrice" parameterType="string" resultType="int">
		SELECT price
		FROM product_detail a, product b
		WHERE a.product_id = b.product_id and a.product_detail_id = #{productDetailId}
	</select>
	
	<select id="selectTotalProductDetailBySearch" parameterType="map" resultType="int">
		SELECT count(*)
		FROM product_detail b, product a, stock c
		WHERE 
		a.product_id = b.product_id AND
		b.product_detail_id = c.product_detail_id AND
		<if test="searchType == 'None' ">
			(a.product_id like '%'||#{keyWord}||'%' 
				OR a.name like '%'||#{keyWord}||'%'
				OR a.brand_name like '%'||#{keyWord}||'%')
		</if>
		<if test="searchType != 'None' ">
			a.${searchType} like '%'||#{keyWord}||'%'
		</if>
	</select>
	
	
	<select id="selectProductDetailBySearch" parameterType="map" resultType="productDetail">
	
		SELECT rnum , product_id, name, brand_name, product_detail_id
		FROM(SELECT rownum as rnum, product_id, name, brand_name, product_detail_id
		FROM(SELECT a.product_id, a.name, a.brand_name, b.product_detail_id
		FROM product_detail b, product a
		WHERE 
		a.product_id = b.product_id AND
		<if test="searchType == 'None' ">
			(a.product_id like '%'||#{keyWord}||'%' 
				OR a.name like '%'||#{keyWord}||'%'
				OR a.brand_name like '%'||#{keyWord}||'%')
		</if>
		<if test="searchType != 'None' ">
			a.${searchType} like '%'||#{keyWord}||'%'
		</if>
		
		order by ${sortId}
		)c where <![CDATA[rownum<=#{endRow}]]> ) d where  <![CDATA[rnum>= #{startRow}]]> 
	</select>
</mapper>


